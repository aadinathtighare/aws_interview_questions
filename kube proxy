тШ╕я╕П Kube-proxy рдореНрд╣рдгрдЬреЗ рдХрд╛рдп?

kube-proxy рд╣рд╛ Kubernetes рдЪрд╛ network component рдЖрд╣реЗ тАФ
рдЬреЛ рдкреНрд░рддреНрдпреЗрдХ node рд╡рд░ рдЪрд╛рд▓рддреЛ рдЖрдгрд┐ рддреЛ Service рдЖрдгрд┐ Pods рдордзрд▓рд╛ traffic route / forward рдХрд░рддреЛ.

рдореНрд╣рдгрдЬреЗрдЪ kube-proxy рдЪрдВ рдХрд╛рдо рдЖрд╣реЗ тАФ

тАЬcluster рдордзреНрдпреЗ рдХреЛрдгрддреНрдпрд╛ Service рд▓рд╛ рдХреЛрдгрддреНрдпрд╛ Pod рдХрдбреЗ traffic рдкрд╛рдард╡рд╛рдпрдЪрдВ рд╣реЗ manage рдХрд░рдгрдВ.тАЭ

тЪЩя╕П Main рдХрд╛рдордВ (Responsibilities)
рдХрд╛рдо	Explanation
ЁЯзй 1. Service тЖТ Pod traffic routing	рдЬреЗрд╡реНрд╣рд╛ рддреВ рдПрдЦрд╛рджреА Service рддрдпрд╛рд░ рдХрд░рддреЛрд╕ (рдЙрджрд╛. frontend-service), kube-proxy рддреНрдпрд╛рдЪреЗ backend pods рд╢реЛрдзрддреЛ рдЖрдгрд┐ traffic рддреНрдпрд╛рдВрдЪреНрдпрд╛ IP рдХрдбреЗ redirect рдХрд░рддреЛ.
ЁЯз▒ 2. iptables / IPVS rules maintain рдХрд░рдгреЗ	kube-proxy node рд╡рд░ iptables рдХрд┐рдВрд╡рд╛ IPVS рд╡рд╛рдкрд░реВрди network rules рддрдпрд╛рд░ рдХрд░рддреЛ. рдпрд╛ rules рдореБрд│реЗ packets рдпреЛрдЧреНрдп pod рдкрд░реНрдпрдВрдд рдкреЛрд╣реЛрдЪрддрд╛рдд.
ЁЯФБ 3. Load balancing	рдЬрд░ Service рдорд╛рдЧреЗ multiple pods рдЕрд╕рддреАрд▓, kube-proxy round-robin / random style рдиреЗ traffic distribute рдХрд░рддреЛ.
ЁЯФН 4. Cluster networking abstraction	Applications рдирд╛ backend pods рдЪреЗ IP directly рдорд╛рд╣реАрдд рдирд╕рддрд╛рдд тАФ рддреЗ рдлрдХреНрдд service name рд╡рд╛рдкрд░рддрд╛рдд. kube-proxy рд╣реЗ translate рдХрд░рддреЛ.
ЁЯза рдереЛрдбрдВ рдЦреЛрд▓рд╛рдд рдмрдШреВ (Example)

рд╕рдордЬ тАФ
рддреБрдЭреНрдпрд╛рдХрдбреЗ 2 microservices рдЖрд╣реЗрдд:

frontend

backend

frontend рд▓рд╛ backend рд╢реА рдмреЛрд▓рд╛рдпрдЪрдВ рдЖрд╣реЗ.

Without kube-proxy

рддреБрд▓рд╛ backend pod рдЪрд╛ exact IP рдорд╛рд╣реАрдд рдЕрд╕рд╛рд╡рд╛ рд▓рд╛рдЧреЗрд▓ (рдЬреЛ рдмрджрд▓рдд рд░рд╛рд╣рддреЛ). тЭМ

With kube-proxy

рддреВ рдлрдХреНрдд backend рдЪреНрдпрд╛ service рд▓рд╛ call рдХрд░рд╢реАрд▓:

http://backend-service:8080


kube-proxy internally route рдХрд░реЗрд▓ тАФ
тЖТ рддреНрдпрд╛ service рдорд╛рдЧрдЪреНрдпрд╛ backend pods рдкреИрдХреА рдПрдХрд╛ рдХрдбреЗ. тЬЕ

ЁЯз░ kube-proxy modes
Mode	Description
iptables (default)	kube-proxy iptables rules рд╡рд╛рдкрд░рддреЛ packets redirect рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА. Fast рдЖрдгрд┐ simple.
IPVS	Advanced mode, Linux IP Virtual Server рд╡рд╛рдкрд░рддреЛ. рдЬрд╛рд╕реНрдд efficient рдЖрдгрд┐ scalable.
userspace (old)	рдЬреБрдирд╛ mode рд╣реЛрддрд╛, рдЖрддрд╛ rarely рд╡рд╛рдкрд░рддрд╛рдд.
