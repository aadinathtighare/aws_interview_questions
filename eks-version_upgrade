Q. i hv eks cluster i want to do version upgrade so can I create new node group with new version in same eks cluster ?
Q. if I drain and cordan old nodes in old node group then how to migrate workload ?
its automatic or manually ?
ЁЯСЙ Workload migration is AUTOMATIC, but you trigger it manually.

Cordon/Drain тЖТ manual action (by you)

Pod rescheduling тЖТ automatic (by Kubernetes)
-------------------------------------------------------------------
PDB is VERY important exactly in the node drain / upgrade situation you described. тАЬDuring voluntary disruptions (like drain, upgrade), how many pods are allowed to go down at a time.тАЭ

It protects your application from downtime.

apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: app-pdb
  namespace: default
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: my-app
-----------------------------
тЭМ PDB mhanje тАЬpod old node var chaluch pahijeтАЭ asa nahi

тЬЕ PDB mhanje тАЬcluster madhe kamit kami 1 pod running pahijeтАЭ

Pod:

Old node var asu shakto

Kinva new node var asu shakto
================
PDB ensures that during node draining, Kubernetes evicts pods gradually so that the minimum required pods remain available, enabling zero-downtime upgrades.
===============================================
ЁЯФ╣ Commands to test PDB behavior
# kubectl get pdb -A
# kubectl describe pdb app-pdb
===================================================
what is the kind for cluster autoscaler ?
Cluster Autoscaler (CA) itself is typically installed as a Deployment object.
kind: Deployment
-------------------------------------------------------
Q. in eks during eks version upgrade i created new node group with new version so after workload migration is completed from old node group to new node group 
which node group I can delete ?
--> In an EKS version upgrade scenario where you have already created a new node group and migrated your workloads, you should delete the Old Node Group (the one running the previous Kubernetes version).
------------------------
Q. in my case what i did i created new node-group with new version & upgrade the old node group ?
--> In your specific situation, since you have both a new node group (at the new version) and an upgraded old node group (now also at the new version), you technically have a "Blue-Green" setup where both groups are now identical in version.

You should delete the New Node Group that you created as a temporary migration target.
-------------------------------------------------------------------------------------------------------------------------------------------------------------
Q. in aws console eks there is update option for node group so what exactly happen in background when we click in update ?
--> AWS Console рдордзреВрди рдЬреЗрд╡реНрд╣рд╛ рддреВ EKS Node Group рдЪреНрдпрд╛ "Update" рдмрдЯрдгрд╡рд░ рдХреНрд▓рд┐рдХ рдХрд░рддреЛрд╕, рддреЗрд╡реНрд╣рд╛ рдмреЕрдХрдЧреНрд░рд╛рдЙрдВрдбрдордзреНрдпреЗ рдПрдХ рдЦреВрдк рдорд╣рддреНрддреНрд╡рд╛рдЪреА рдкреНрд░реЛрд╕реЗрд╕ рдЪрд╛рд▓рддреЗ рдЬрд┐рд▓рд╛ "Rolling Update" рдореНрд╣рдгрддрд╛рдд.

рдпрд╛рдЪрд╛ рдореБрдЦреНрдп рдЙрджреНрджреЗрд╢ рд╣рд╛рдЪ рдЕрд╕рддреЛ рдХреА рддреБрдордЪреЗ Application рдЪрд╛рд▓реВ рдЕрд╕рддрд╛рдирд╛ (Zero Downtime) рдирд╡реАрди Nodes ре▓рдб рд╡реНрд╣рд╛рд╡реЗрдд рдЖрдгрд┐ рдЬреБрдиреЗ Nodes рдХрд╛рдвреВрди рдЯрд╛рдХрд╛рд╡реЗрдд.
-------------------------------------------------------------------------------------------------------------------------------------------------------------------
Q. suppose i m using terraform for eks version upgrade so i need to upgrade first control plane then add ons then worker nodes , how it possible in terraform ?
--> рд╣реЛ, Terraform рдордзреНрдпреЗ EKS рдЕрдкрдЧреНрд░реЗрдб рдХрд░рддрд╛рдирд╛ рд╣реАрдЪ рдкрджреНрдзрдд (Control Plane -> Add-ons -> Worker Nodes) рдлреЙрд▓реЛ рдХрд░рдгреЗ рдЧрд░рдЬреЗрдЪреЗ рдЖрд╣реЗ.
Terraform рдордзреНрдпреЗ рдПрдХрд╛рдЪ рд╡реЗрд│реА рд╕рд░реНрд╡ рд╡реНрд╣рд░реНрдЬрдиреНрд╕ рдмрджрд▓рдгреНрдпрд╛рдкреЗрдХреНрд╖рд╛, рдПрдХрд╛рдорд╛рдЧреВрди рдПрдХ apply рдХрд░рдгреЗ рд╕рд░реНрд╡рд╛рдд рд╕реБрд░рдХреНрд╖рд┐рдд рдЕрд╕рддреЗ.
Step 1: Control Plane Upgrade рдЖрдзреА рдлрдХреНрдд aws_eks_cluster рд░рд┐рд╕реЛрд░реНрд╕рдордзреАрд▓ version рдЕрдкрдбреЗрдЯ рдХрд░рд╛ (рдЙрджрд╛. 1.30 рд╡рд░реВрди 1.31).
# terraform apply -target=aws_eks_cluster.example

Step 2: Add-ons Upgrade рдХрдВрдЯреНрд░реЛрд▓ рдкреНрд▓реЗрди рдЕрдкрдбреЗрдЯ рдЭрд╛рд▓реНрдпрд╛рд╡рд░, aws_eks_addon рд░рд┐рд╕реЛрд░реНрд╕рдордзреНрдпреЗ рдЬрд╛рдКрди addon_version рдЕрдкрдбреЗрдЯ рдХрд░рд╛. рдирд╡реАрди K8s рд╡реНрд╣рд░реНрдЬрдирд▓рд╛ рд╕рдкреЛрд░реНрдЯ рдХрд░рдгрд╛рд░реАрдЪ рд╡реНрд╣рд░реНрдЬрди рдирд┐рд╡рдбрд╛.
# terraform apply -target=aws_eks_addon.vpc_cni

Step 3: Worker Nodes Upgrade рд╢реЗрд╡рдЯреА aws_eks_node_group рдордзреАрд▓ version рдХрд┐рдВрд╡рд╛ ami_type рдЕрдкрдбреЗрдЯ рдХрд░рд╛.
# terraform apply -target=aws_eks_node_group.example

---------------------------------
реи. рдХреЛрдбрдордзреНрдпреЗ 'Depends On' рдЪрд╛ рд╡рд╛рдкрд░ рдХрд░рдгреЗ
рдЬрд░ рддреБрдореНрд╣рд╛рд▓рд╛ рд╕рд░реНрд╡ рдХрд╛рд╣реА рдПрдХрд╛рдЪ terraform apply рдордзреНрдпреЗ рдХрд░рд╛рдпрдЪреЗ рдЕрд╕реЗрд▓, рддрд░ рддреБрдореНрд╣реА depends_on рд╣реЗ рдЖрд░реНрдЧреБрдореЗрдВрдЯ рд╡рд╛рдкрд░реВрди рдХреНрд░рдо рдард░рд╡реВ рд╢рдХрддрд╛. рдпрд╛рдореБрд│реЗ Terraform рд▓рд╛ рдХрд│рддреЗ рдХреА рдЖрдзреА рдХрд╛рдп рдкреВрд░реНрдг рдЭрд╛рд▓реЗ рдкрд╛рд╣рд┐рдЬреЗ.
# 1. EKS Cluster (Control Plane)
resource "aws_eks_cluster" "my_cluster" {
  name     = "production-cluster"
  version  = "1.31" # рдирд╡реАрди рд╡реНрд╣рд░реНрдЬрди
  role_arn = aws_iam_role.cluster.arn
  # ... рдЗрддрд░ рдХреЙрдиреНрдлрд┐рдЧ
}

# 2. EKS Add-ons (Depends on Cluster)
resource "aws_eks_addon" "vpc_cni" {
  cluster_name  = aws_eks_cluster.my_cluster.name
  addon_name    = "vpc-cni"
  addon_version = "v1.18.1-eksbuild.1" 

  # рдХреНрд▓рд╕реНрдЯрд░ рдЕрдкрдбреЗрдЯ рдЭрд╛рд▓реНрдпрд╛рд╢рд┐рд╡рд╛рдп рд╣реЗ рд╕реБрд░реВ рд╣реЛрдгрд╛рд░ рдирд╛рд╣реА
  depends_on = [aws_eks_cluster.my_cluster]
}

# 3. Node Group (Depends on Add-ons/Cluster)
resource "aws_eks_node_group" "worker_nodes" {
  cluster_name    = aws_eks_cluster.my_cluster.name
  node_group_name = "standard-workers"
  version         = "1.31" # рдХреНрд▓рд╕реНрдЯрд░ рд╡реНрд╣рд░реНрдЬрдирд╢реА рдореЕрдЪ рдХрд░рд╛

  # рд╣реЗ рд╢реЗрд╡рдЯреВрди рдЕрдкрдбреЗрдЯ рд╣реЛрдИрд▓
  depends_on = [aws_eks_cluster.my_cluster, aws_eks_addon.vpc_cni]
}
============================================================================
Sequential Apply: рдореЛрдареНрдпрд╛ рдкреНрд░реЛрдбрдХреНрд╢рди рдХреНрд▓рд╕реНрдЯрд░рдордзреНрдпреЗ depends_on рдкреЗрдХреНрд╖рд╛ рдореЕрдиреНрдпреБрдЕрд▓реА рдПрдХрд╛рдорд╛рдЧреВрди рдПрдХ -target рдлреНрд▓реЕрдЧ рд╡рд╛рдкрд░реВрди рдЕрдкреНрд▓рд╛рдп рдХрд░рдгреЗ рдЬрд╛рд╕реНрдд 'Safe' рдорд╛рдирд▓реЗ рдЬрд╛рддреЗ, рдХрд╛рд░рдг рдпрд╛рдореБрд│реЗ рддреБрдореНрд╣рд╛рд▓рд╛ рдкреНрд░рддреНрдпреЗрдХ рдЯрдкреНрдкреНрдпрд╛рд╡рд░ рдПрд░рд░ рдЪреЗрдХ рдХрд░рддрд╛ рдпреЗрддрд╛рдд.
==========================================================================================================================
in terraform.tfvars 
we are giving values like ami_id for node group
add ons versions
--------------------------------------------

Q. suppose i m using jenkins pipeline for creating  eks cluster by terraform then i want to upgrade eks version so can I use jenkins pipeline for upgrdae version also ?
рд░рд┐рдЕрд▓-рдЯрд╛рдЗрдо рдкреНрд░реЛрдбрдХреНрд╢рдирдордзреНрдпреЗ Jenkins Pipeline рд╡рд╛рдкрд░реВрди EKS рдЕрдкрдЧреНрд░реЗрдб рдХрд░рдгреЗ рд╣реА рд╕рд░реНрд╡рд╛рдд рдЙрддреНрддрдо рдЖрдгрд┐ 'Standard' рдкрджреНрдзрдд рдЖрд╣реЗ. рдореЕрдиреНрдпреБрдЕрд▓реА рдЖрдкрд▓реНрдпрд╛ рд▓реЕрдкрдЯреЙрдкрд╡рд░реВрди terraform apply рдХрд░рдгреНрдпрд╛рдкреЗрдХреНрд╖рд╛ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рд╡рд╛рдкрд░рд▓реНрдпрд╛рдореБрд│реЗ рдХрд╛рдорд╛рдд рдкрд╛рд░рджрд░реНрд╢рдХрддрд╛ рдЖрдгрд┐ рд╕реБрд░рдХреНрд╖рд┐рддрддрд╛ рд░рд╛рд╣рддреЗ.

Stage 1 (Control Plane): terraform apply -target=aws_eks_cluster.my_cluster рдЪрд╛рд▓рд╡реВрди рдЖрдзреА рдорд╛рд╕реНрдЯрд░ рдиреЛрдбреНрд╕ рдЕрдкрдЧреНрд░реЗрдб рдХрд░рд╛.

Stage 2 (Add-ons): рддреНрдпрд╛рдирдВрддрд░ CoreDNS, VPC-CNI рдЖрдгрд┐ kube-proxy рдЕрдкрдбреЗрдЯ рдХрд░рд╛.

Stage 3 (Nodes): рд╢реЗрд╡рдЯреА рдиреЛрдб рдЧреНрд░реБрдк рдЕрдкрдбреЗрдЯ рдХрд░рд╛. рдЬрд░ рддреБрдореНрд╣реА Managed Node Groups рд╡рд╛рдкрд░рдд рдЕрд╕рд╛рд▓, рддрд░ рдЯреЗрд░рд╛рдлреЙрд░реНрдо рдЖрдкреЛрдЖрдк рд░реЛрд▓рд┐рдВрдЧ рдЕрдкрдбреЗрдЯ (Rolling Update) рдХрд░реЗрд▓, рдЬреНрдпрд╛рдореБрд│реЗ рддреБрдордЪреЗ ре▓рдкреНрд▓рд┐рдХреЗрд╢рди рдЪрд╛рд▓реВ рд░рд╛рд╣реАрд▓.

=====================
Q. so Stage┬а1 Control Plane, Stage 2 (Add-ons), Stage 3 (Node group ) give me full pipeline ?
pipeline {
    agent any

    environment {
        AWS_REGION     = "us-east-1"
        TF_VAR_version = "1.31" // рдЯрд╛рд░реНрдЧреЗрдЯ рд╡реНрд╣рд░реНрдЬрди рдЗрдереЗ рд╕реЗрдЯ рдХрд░рд╛
    }

    stages {
        stage('Checkout & Init') {
            steps {
                git branch: 'main', url: 'https://github.com/your-repo/eks-terraform.git'
                sh 'terraform init'
            }
        }

        stage('Terraform Plan') {
            steps {
                // рдЕрдкрдЧреНрд░реЗрдбрдЪрд╛ рд░рд┐рд╡реНрд╣реНрдпреВ рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рдЖрдзреА рдкреНрд▓реЕрди рдкрд╛рд╣рдгреЗ
                sh 'terraform plan'
            }
        }

        stage('Stage 1: Upgrade Control Plane') {
            steps {
                input message: "Upgrade EKS Control Plane to ${env.TF_VAR_version}?"
                sh 'terraform apply -target=aws_eks_cluster.my_cluster -auto-approve'
            }
        }

        stage('Stage 2: Upgrade Add-ons') {
            steps {
                echo "Upgrading VPC-CNI, CoreDNS, and Kube-Proxy..."
                // ре▓рдб-рдСрдиреНрд╕ рдЕрдкрдбреЗрдЯ рдХрд░рдгреЗ
                sh 'terraform apply -target=aws_eks_addon.vpc_cni -target=aws_eks_addon.coredns -target=aws_eks_addon.kube_proxy -auto-approve'
            }
        }

        stage('Stage 3: Upgrade Node Groups') {
            steps {
                input message: "Proceed with Worker Node Rolling Update?"
                echo "Updating Node Groups to version ${env.TF_VAR_version}..."
                // рд╢реЗрд╡рдЯреА рдиреЛрдб рдЧреНрд░реБрдк рдЕрдкрдбреЗрдЯ рдХрд░рдгреЗ
                sh 'terraform apply -target=aws_eks_node_group.worker_nodes -auto-approve'
            }
        }
    }

    post {
        success {
            echo "EKS Upgrade Successful!"
        }
        failure {
            echo "EKS Upgrade Failed. Please check the logs."
        }
    }
}
==================================================
Add-on Versions: рд▓рдХреНрд╖рд╛рдд рдареЗрд╡рд╛ рдХреА рдЬреЗрд╡реНрд╣рд╛ рддреБрдореНрд╣реА рдХрдВрдЯреНрд░реЛрд▓ рдкреНрд▓реЗрди 1.31 рд╡рд░ рдиреЗрддрд╛, рддреЗрд╡реНрд╣рд╛ рддреБрдореНрд╣рд╛рд▓рд╛ рддреБрдордЪреНрдпрд╛ Terraform рдХреЛрдбрдордзреНрдпреЗ ре▓рдб-рдСрдиреНрд╕рдЪреЗ рд╡реНрд╣рд░реНрдЬрдиреНрд╕ рджреЗрдЦреАрд▓ рдЕрдкрдбреЗрдЯ рдХрд░рд╛рд╡реЗ рд▓рд╛рдЧрддреАрд▓ рдЬреЗ рддреНрдпрд╛ рдирд╡реАрди K8s рд╡реНрд╣рд░реНрдЬрдирд╢реА рд╕реБрд╕рдВрдЧрдд (compatible) рдЕрд╕рддреАрд▓.

Rolling Updates: рдореЕрдиреЗрдЬреНрдб рдиреЛрдб рдЧреНрд░реБрдкреНрд╕ (Managed Node Groups) рд╡рд╛рдкрд░рдд рдЕрд╕рд▓реНрдпрд╛рдореБрд│реЗ, рд╕реНрдЯреЗрдЬ рей рджрд░рдореНрдпрд╛рди AWS рдЖрдкреЛрдЖрдк рдЬреБрдиреНрдпрд╛ рдиреЛрдбреНрд╕рд▓рд╛ рд░реЛрдЯреЗрдЯ рдХрд░реЗрд▓ (Drain/Cordon) рдЖрдгрд┐ рдирд╡реАрди рдиреЛрдбреНрд╕ ре▓рдб рдХрд░реЗрд▓.
============================================
Q. we have different modules for control plane , add ons , node group ?
--> 

eks-infrastructure/
тФЬтФАтФА modules/
тФВ   тФЬтФАтФА vpc/               # Networking (Subnets, NAT Gateway)
тФВ   тФЬтФАтФА control-plane/     # EKS Cluster resource, IAM roles
тФВ   тФЬтФАтФА addons/            # EKS Addons (VPC-CNI, CoreDNS, etc.)
тФВ   тФФтФАтФА node-groups/       # Managed Node Groups or Self-managed nodes
тФЬтФАтФА dev/
тФВ   тФФтФАтФА main.tf            # 'dev' рд╕рд╛рдареА рд╕рд░реНрд╡ рдореЙрдбреНрдпреВрд▓реНрд╕ рдХреЙрд▓ рдХрд░рдгреЗ
тФФтФАтФА prod/
    тФФтФАтФА main.tf            # 'prod' рд╕рд╛рдареА рд╕рд░реНрд╡ рдореЙрдбреНрдпреВрд▓реНрд╕ рдХреЙрд▓ рдХрд░рдгреЗ
============================================================================
рд╣реЛ, рд░рд┐рдЕрд▓-рдЯрд╛рдЗрдо рдкреНрд░реЛрдбрдХреНрд╢рдирдордзреНрдпреЗ (Real-time Production) Terraform Modules рд╡рд╛рдкрд░рдгреЗ рд╣реАрдЪ 'Best Practice' рдЖрд╣реЗ. рдПрдХрд╛рдЪ рдореЛрдареНрдпрд╛ main.tf рдлрд╛рдИрд▓рдордзреНрдпреЗ рд╕рд░реНрд╡ рдХрд╛рд╣реА рд▓рд┐рд╣рд┐рдгреНрдпрд╛рдРрд╡рдЬреА, рддреЗ рд╡реЗрдЧрд╡реЗрдЧрд│реНрдпрд╛ рдореЙрдбреНрдпреВрд▓реНрд╕рдордзреНрдпреЗ рд╡рд┐рднрд╛рдЧрд▓реНрдпрд╛рдореБрд│реЗ рдХреЛрдб рдореЕрдиреЗрдЬ рдХрд░рдгреЗ, рд╡рд╛рдЪрдгреЗ рдЖрдгрд┐ рдЕрдкрдЧреНрд░реЗрдб рдХрд░рдгреЗ рдЦреВрдк рд╕реЛрдкреЗ рд╣реЛрддреЗ.рдпреЗрдереЗ рдПрдХ рд╕реНрдЯрдБрдбрд░реНрдб рдлреЛрд▓реНрдбрд░ рд╕реНрдЯреНрд░рдХреНрдЪрд░ рдЖрдгрд┐ рдкреНрд░рддреНрдпреЗрдХ рдореЙрдбреНрдпреВрд▓рдЪрд╛ рдЙрджреНрджреЗрд╢ рджрд┐рд▓рд╛ рдЖрд╣реЗ:рез. рдлреЛрд▓реНрдбрд░ рд╕реНрдЯреНрд░рдХреНрдЪрд░ (Standard Directory Structure)Plaintexteks-infrastructure/
тФЬтФАтФА modules/
тФВ   тФЬтФАтФА vpc/               # Networking (Subnets, NAT Gateway)
тФВ   тФЬтФАтФА control-plane/     # EKS Cluster resource, IAM roles
тФВ   тФЬтФАтФА addons/            # EKS Addons (VPC-CNI, CoreDNS, etc.)
тФВ   тФФтФАтФА node-groups/       # Managed Node Groups or Self-managed nodes
тФЬтФАтФА dev/
тФВ   тФФтФАтФА main.tf            # 'dev' рд╕рд╛рдареА рд╕рд░реНрд╡ рдореЙрдбреНрдпреВрд▓реНрд╕ рдХреЙрд▓ рдХрд░рдгреЗ
тФФтФАтФА prod/
    тФФтФАтФА main.tf            # 'prod' рд╕рд╛рдареА рд╕рд░реНрд╡ рдореЙрдбреНрдпреВрд▓реНрд╕ рдХреЙрд▓ рдХрд░рдгреЗ
реи. рдореЙрдбреНрдпреВрд▓реНрд╕рдЪреЗ рд╡рд┐рднрд╛рдЬрди рдХрд╛ рдХрд░рд╛рд╡реЗ?рдореЙрдбреНрдпреВрд▓ (Module)рдЬрдмрд╛рдмрджрд╛рд░реА (Responsibility)рдЕрдкрдЧреНрд░реЗрдбрдЪрд╛ рдлрд╛рдпрджрд╛Control PlaneрдХреНрд▓рд╕реНрдЯрд░рдЪреЗ рдирд╛рд╡, рд╡реНрд╣рд░реНрдЬрди, рдЖрдгрд┐ API рдПрдХреНрд╕реЗрд╕ рдореЕрдиреЗрдЬ рдХрд░рдгреЗ.
рдЖрдзреА рдлрдХреНрдд рд╣реЗрдЪ рдореЙрдбреНрдпреВрд▓ рдЕрдкрдбреЗрдЯ рдХрд░реВрди рдХрдВрдЯреНрд░реЛрд▓ рдкреНрд▓реЗрди рдЕрдкрдЧреНрд░реЗрдб рдХрд░рддрд╛ рдпреЗрддреЗ.Add-onsрдиреЗрдЯрд╡рд░реНрдХрд┐рдВрдЧ рдЖрдгрд┐ DNS рдкреНрд▓рдЧрдЗрдиреНрд╕ рдореЕрдиреЗрдЬ рдХрд░рдгреЗ.рдХреНрд▓рд╕реНрдЯрд░ рд╡реНрд╣рд░реНрдЬрди рдмрджрд▓рд▓реНрдпрд╛рд╡рд░ рдлрдХреНрдд рдпрд╛ рдореЙрдбреНрдпреВрд▓рдЪреЗ рд╡реНрд╣реЗрд░рд┐рдПрдмрд▓реНрд╕ рдмрджрд▓реВрди ре▓рдб-рдСрдиреНрд╕ рдЕрдкрдбреЗрдЯ рд╣реЛрддрд╛рдд.
Node Groupsрд╡рд░реНрдХрд░реНрд╕рдЪреА рд╕рдВрдЦреНрдпрд╛, AMI рдЯрд╛рдИрдк рдЖрдгрд┐ рд╡реНрд╣рд░реНрдЬрди рдореЕрдиреЗрдЬ рдХрд░рдгреЗ.рдХрдВрдЯреНрд░реЛрд▓ рдкреНрд▓реЗрди рд╕реНрдерд┐рд░ рдЭрд╛рд▓реНрдпрд╛рд╡рд░ рд╕рд░реНрд╡рд╛рдд рд╢реЗрд╡рдЯреА рд╣реЗ рдореЙрдбреНрдпреВрд▓ рд░рди рдХреЗрд▓реЗ рдЬрд╛рддреЗ.

рей. Jenkins Pipeline рдЖрдгрд┐ Modules рдЪрд╛ рд╕рдВрдмрдВрдзрдЬреЗрд╡реНрд╣рд╛ рддреБрдореНрд╣реА рдореЙрдбреНрдпреВрд▓реНрд╕ рд╡рд╛рдкрд░рддрд╛,
рддреЗрд╡реНрд╣рд╛ рддреБрдордЪреНрдпрд╛ Jenkins Pipeline рдордзреАрд▓ -target рдХрдорд╛рдВрдб рдЕрдзрд┐рдХ рдкреНрд░рднрд╛рд╡реА рдард░рддреЗ.

====================
Q. so i want to so like 1st stage first complete and then 2nd . how to do that ?
Jenkins рдордзреНрдпреЗ рдПрдХрд╛ рд╕реНрдЯреЗрдЬ рдирдВрддрд░ рджреБрд╕рд░реА рд╕реНрдЯреЗрдЬ (sequential execution) рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рддреБрдореНрд╣рд╛рд▓рд╛ рд╡реЗрдЧрд│рдВ рдХрд╛рд╣реА рдХрд░рдгреНрдпрд╛рдЪреА рдЧрд░рдЬ рдирд╛рд╣реА, рдХрд╛рд░рдг Jenkinsfile рдордзреНрдпреЗ рд▓рд┐рд╣рд┐рд▓реЗрд▓реНрдпрд╛ Stages рдПрдХрд╛рдкрд╛рдареЛрдкрд╛рда рдПрдХрдЪ (Top to Bottom) рд░рди рд╣реЛрддрд╛рдд.

рдкрдг рдкреНрд░реЛрдбрдХреНрд╢рдирдордзреНрдпреЗ рд╕реБрд░рдХреНрд╖рд┐рддрддреЗрд╕рд╛рдареА Stage 1 рдкреВрд░реНрдгрдкрдгреЗ рдпрд╢рд╕реНрд╡реА рдЭрд╛рд▓реНрдпрд╛рд╢рд┐рд╡рд╛рдп Stage 2 рд╕реБрд░реВ рд╣реЛрдК рдирдпреЗ, рдпрд╛рд╕рд╛рдареА рдЖрдкрдг input рдХрд┐рдВрд╡рд╛ waitUntil рд▓реЙрдЬрд┐рдХ рд╡рд╛рдкрд░реВ рд╢рдХрддреЛ.

pipeline {
    agent any
    
    stages {
        // --- STAGE 1: CONTROL PLANE ---
        stage('Stage 1: Upgrade Control Plane') {
            steps {
                echo "Upgrading Control Plane to 1.31..."
                // рдлрдХреНрдд рдХреНрд▓рд╕реНрдЯрд░рд▓рд╛ рдЯрд╛рд░рдЧреЗрдЯ рдХрд░рд╛
                sh 'terraform apply -target=aws_eks_cluster.my_cluster -auto-approve'
                
                // рдЗрдереЗ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдерд╛рдВрдмреЗрд▓ рдЬреЛрдкрд░реНрдпрдВрдд рддреБрдореНрд╣реА 'Proceed' рд╡рд░ рдХреНрд▓рд┐рдХ рдХрд░рдд рдирд╛рд╣реА
                input message: "Control Plane upgrade complete? Check AWS Console and then click Proceed for Add-ons."
            }
        }

        // --- STAGE 2: ADD-ONS ---
        stage('Stage 2: Upgrade Add-ons') {
            steps {
                echo "Upgrading Add-ons (VPC-CNI, CoreDNS, Kube-proxy)..."
                // ре▓рдб-рдСрдиреНрд╕рдирд╛ рдЯрд╛рд░рдЧреЗрдЯ рдХрд░рд╛
                sh 'terraform apply -target=aws_eks_addon.vpc_cni -target=aws_eks_addon.coredns -target=aws_eks_addon.kube_proxy -auto-approve'
                
                input message: "Add-ons updated? Click Proceed to start Node Group upgrade."
            }
        }

        // --- STAGE 3: WORKER NODES ---
        stage('Stage 3: Upgrade Node Groups') {
            steps {
                echo "Starting Rolling Update for Worker Nodes..."
                // рдиреЛрдб рдЧреНрд░реБрдкрд▓рд╛ рдЯрд╛рд░рдЧреЗрдЯ рдХрд░рд╛
                sh 'terraform apply -target=aws_eks_node_group.worker_nodes -auto-approve'
            }
        }
    }
}
=============================
рд▓рдХреНрд╖рд╛рдд рдареЗрд╡рд╛ (Important for Production)
Timeouts: рдХрдВрдЯреНрд░реЛрд▓ рдкреНрд▓реЗрди рдЕрдкрдЧреНрд░реЗрдб рдХрдзреАрдХрдзреА реиреж рдорд┐рдирд┐рдЯрд╛рдВрдкреЗрдХреНрд╖рд╛ рдЬрд╛рд╕реНрдд рд╡реЗрд│ рдШреЗрдК рд╢рдХрддреЛ. рддреБрдордЪреНрдпрд╛ рдЬреЗрдирдХрд┐рдиреНрд╕ рдЬреЙрдмрдордзреНрдпреЗ 'Timeout' рд╕реЗрдЯрд┐рдВрдЧ рд╡рд╛рдврд╡реВрди рдареЗрд╡рд╛.

Dependency: рдЯреЗрд░рд╛рдлреЙрд░реНрдо рдХреЛрдбрдордзреНрдпреЗ depends_on рд╡рд╛рдкрд░рд▓рд╛ рдЕрд╕реЗрд▓, рддрд░ рдЯреЗрд░рд╛рдлреЙрд░реНрдо рдЖрдкреЛрдЖрдк рдХреНрд░рдо рдард░рд╡рддреЛ, рдкрдг рдкрд╛рдЗрдкрд▓рд╛рдЗрдирдордзреНрдпреЗ рд╡реЗрдЧрд│реЗ рд╕реНрдЯреЗрдЬреЗрд╕ рдареЗрд╡рд▓реНрдпрд╛рдиреЗ рддреБрдореНрд╣рд╛рд▓рд╛ рдкреНрд░рддреНрдпреЗрдХ рдЯрдкреНрдкреНрдпрд╛рд╡рд░ "Visibility" рдорд┐рд│рддреЗ.
============================










